---
title: "R Notebook"
output: html_notebook
---

```{r}
# loading in SLICER packages
library("devtools")
install_github("jw156605/SLICER")
library(SLICER)
library(lle)
```


```{r}
# finding the number of initial clusters for reconstructing the trajectory
k = select_k(top_genes_norm, kmin = 3)
```
```{r}
# performing LLE a form of dimensionality reduction on the gene expression data
# m = 3 bc that is the number of dimensions used in the figures in the paper 
traj_lle = lle(top_genes_norm, m=3, k)$Y
```


```{r}
# build a knearest neighbor graph to find the distances betwen cells
traj_graph = conn_knn_graph(traj_lle, k)
```
```{r}
# constructing the cell order and finding branches in the trajectory 
ends = find_extreme_cells(traj_graph, traj_lle)
start = 1 # needs to be changed to a known cardiac fibroblast 
cells_ordered = cell_order(traj_graph, start)
graph_process_distance(traj_graph,traj_lle,start)
branches = assign_branches(traj_graph,start, min_branch_len = 30)
```



```{r}
distances = process_distance(traj_graph, 192)
```
```{r}
scatterplot3d(traj_lle[,1],traj_lle[,3],traj_lle[,2], grid = FALSE)
```

```{r}
library(rgl)
library(plotly)
```

```{r}
plot3d(traj_lle[,1],traj_lle[,3],traj_lle[,2],type = "s", size = 1, lit = TRUE) 
```


```{r}
lle_df = data.frame(traj_lle )
lle_df$dist = as.double(t(distances))
```


```{r}
fig <- plot_ly(lle_df, x = ~X1, y = ~X2, z = ~X3, marker = list(color = ~dist, colorscale = c('#FFE1A1', '#683531'), showscale = TRUE))
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(aspectmode = "cube"))
fig
```

```{r}
plot(traj_lle,pch=16,col=branches)

```

